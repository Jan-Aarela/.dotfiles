#!/bin/bash
# Read before executing.

# Disclaimer.
echo -e "\033[33mYou are about to execute a script that \033[43;30m WILL OVERWRITE \033[0m\033[33m current files in ~/.config! 
Please, inspect this script with the text editor of your choice before execution.
There you can select dotfiles to configure (CONFIGS array).

Keep in mind, config files such as ENV, monitor settings, keybinds...
are preconfigured for author's device.
So, if you suddently get a \033[43;30m BLACK SCREEN \033[0m\033[33m, that's why.\033[0m"

# Comment items to exclude.
CONFIGS=(
  "hypr"
  "i3"
  "cava"
  "broot"
  "zathura"
  "fish"
  "nvim"
  "picom.conf"
)

# List selected configs
echo -e "\n\033[34mSelected configs:\033[0m"
for CONFIG in "${CONFIGS[@]}"; do
  echo "$CONFIG"
done
echo

# y/N confirmation
read -p "Are you sure you want to proceed? (y/N): " -n 1 -r REPLY
echo

# Check y/N
if [[ $REPLY =~ ^[Yy]$ ]]; then
  echo

  i=3
  while [ $i -gt 0 ]; do
    echo -e "\033[31mStarting in... $i\033[0m"
    sleep 1
    i=$((i - 1))
  done

  echo -e "\033[41;30mCONFIGURATION STARTED!\033[0m"
else
  echo -e "\n\033[41;30mCONFIGURATION ABORTED!\033[0m"
  exit 1 # Exit with a non-zero status to signal failure
fi

# Get dotfiles location
DOTFILES=$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" &>/dev/null && pwd)
echo -e "\n\033[34mDotfiles location:\033[0m\n$DOTFILES"

# Makes scripts executable
chmod +x "$DOTFILES"/hypr/scripts/*
echo -e "\n\033[34mScripts now executable:\033[0m\n$DOTFILES/hypr/scripts/"

# Unlink configs
COUNT=0
echo -e "\n\033[34mSymlinks removed:\033[0m"
for CONFIG in "${CONFIGS[@]}"; do
  if [ -h ~/.config/"$CONFIG" ]; then
    echo "~/.config/"$CONFIG"@"
    unlink ~/.config/"$CONFIG"
    COUNT=$((COUNT + 1))
  fi
done
if [[ $COUNT == 0 ]]; then
  echo "No existing directories or files"
fi

# Create backups
COUNT=0
echo -e "\n\033[34mBackups created:\033[0m"
for CONFIG in "${CONFIGS[@]}"; do
  if [[ -f ~/.config/"$CONFIG" || -d ~/.config/"$CONFIG" ]]; then
    echo ~/.config/"$CONFIG".bkz
    rm -rf ~/.config/"$CONFIG".bkz
    mv ~/.config/"$CONFIG" ~/.config/"$CONFIG".bkz
    COUNT=$((COUNT + 1))
  fi
done
if [[ $COUNT == 0 ]]; then
  echo "No existing directories or files"
fi

# Create symlinks
echo -e "\n\033[34mSymlinks created:\033[0m"
for CONFIG in "${CONFIGS[@]}"; do
  echo "~/.config/"$CONFIG"@ -> $DOTFILES/$CONFIG"
  ln -s "$DOTFILES"/"$CONFIG" ~/.config/
done

echo -e "\n\033[42;30mCONFIGURATION COMPLETED!\033[0m"
